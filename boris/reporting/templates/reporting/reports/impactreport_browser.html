{% extends "print_base.html" %}
{% load i18n %}
{% load i18n services admin_static sstatic %}


{% block title %}
    {% if report_kind == 'services' %}
        {% trans 'Impakt - výkony' %}
    {% else %}
        {% trans 'Impakt - klienti' %}
    {% endif %} {{ block.super }}
{% endblock %}

{% block content_title %}
    <h1>
        {% if report_kind == 'services' %}
            {% trans 'Impakt - tabulka výkony' %}
        {% else %}
            {% trans 'Impakt - tabulka klienti' %}
        {% endif %}
    </h1>
{% endblock %}


{% block extrastyle %}
    {{ block.super }}
    <style>
        body { padding: 0 20px; }
        table td { padding: 5px 5px; }
    </style>
{% endblock %}

{% block content %}
    {% if date_from and date_to %}
        <p style="margin-bottom: 20px;">{{ date_from|date:"j.n.Y" }} - {{ date_to|date:"j.n.Y" }}</p>
    {% endif %}
    {% if towns %}
        <p style="margin-bottom: 20px;">{{ towns|join:", " }}</p>
<!--         <p style="overflow: auto;"></p>
 -->
    {% endif %}
    {% include "reporting/reports/impactreport_data.html" %}
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <link href="{% sstatic 'css/dashboard.css' %}" rel="stylesheet" type="text/css"/>
    <script src="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>


    <h1>Počet kontaktů {{first_contact}}</h1>
    <div id="encounters" class="ct-chart">
        <script>
            new Chartist.Bar('#encounters', {
                labels: ["{{ months | join:'","'}}"],
                series: [
                    {{ encounters | safe }},
                ]
            }, {
                fullWidth: true,
            });
        </script>
    </div>

    <h1>Počet nových klientů</h1>
    <div id="persons" class="ct-chart">
        <script>
            new Chartist.Bar('#persons', {
                labels: ["{{ months | join:'","'}}"],
                series: [
                    {{ persons | safe }},
                ]
            }, {
                fullWidth: true,
            });
        </script>
    </div>

    <h1>Počet vyměněných stříkaček</h1>
    <div id="syringes" class="ct-chart">
        <script>
            new Chartist.Bar('#syringes', {
                labels: ["{{ months | join:'","'}}"],
                series: [
                    {{ syringe | safe }},
                ]
            }, {
                fullWidth: true,
            });
        </script>
    </div>

    <h1>Poměr ohrozěných</h1>
    <div id="potential-clients" class="ct-chart">
        <script>
            new Chartist.Pie('#potential-clients', {
                labels: ["Klienti", "Ohrožení", "Zbytek populace"],
                series: [
                    {{ clients_in_location }}, {{ potential_clients }}, {{ town_population }}
                ],
             }, {
                donut: true,
                donutWidth: 20,
                donutSolid: true,
                startAngle: 270,
                showLabel: true                
             }, [
                ['screen and (min-width: 640px)', {
                    chartPadding: 30,
                    labelOffset: 100,
                    labelDirection: 'explode',
                    labelInterpolationFnc: function(value) {
                      return value;
                    }
                }],
                ['screen and (min-width: 1024px)', {
                    labelOffset: 80,
                    chartPadding: 20
                }]
            ]);
        </script>
    </div>


    <h1>Poměr užívaných narkotik</h1>
    <div id="drug-ratio" class="ct-chart">
        <script>


            new Chartist.Pie('#drug-ratio', {
                labels: ["{{ drug_type_occurrence.labels | join:'","' }}"],
                series: {{ drug_type_occurrence.values }},
             }, {
                donut: true,
                donutWidth: 20,
                donutSolid: true,
                startAngle: 270,
                showLabel: true                
            });
            var data = '{{ encounters | safe }}';
            console.log("data",data);
        </script>
    </div>



    <!-- d3  -->
    <script type="text/javascript">
            var IMPACT = {
                months: ["{{ months| join:'","'}}"],
                encounters: ["{{ encounters | join:'","'}}"],
                drug_type_occurrence : {
                    labels: ["{{ drug_type_occurrence.labels | join:'","' }}"],
                    series: ["{{ drug_type_occurrence.values | join:'","' }}"],
                    //series: {{ drug_type_occurrence.values }},
                },
                encounter_distribution : {
                    bounds: ["{{ enc_dist.bounds | join:'","' }}"],
                    counts: ["{{ enc_dist.counts | join:'","' }}"],
                    labels: ["{{ enc_dist.labels | join:'","' }}"],

                },
                anamnesis: ["{{ anamnesis | join:'","'}}"],
                anamnesis_fields: ["{{ anamnesis_fields | join:'","' }}"]
            };
            // IMPACT.printMonths = function () {console.log(IMPACT.months);}
            //console.log("[{{ client_fields | join:'","' }}]", ["{{ client_fields | join:'","' }}"]);
            console.log('anamnesis',IMPACT.anamnesis);
            console.log('anamnesis[0]',IMPACT.anamnesis[0]);

            console.log('anamnesis[0].extra_first_encounter_date',IMPACT.anamnesis[0].extra_first_encounter_date);
            console.log('anamnesis.client.hygiene_report_code ',IMPACT.anamnesis.client.hygiene_report_code );


    </script>

<!--     <div id="linechart" style="margin: 0; padding: 0; border: 0;">
        <h1>Počet kontaktů - in d3 linechart</h1>
        <script src="http://d3js.org/d3.v3.js"></script>
        <script type="text/javascript" src="{% sstatic 'd3/d3_kontakty_linechart.js' %}"></script>
    </div> -->

    <!-- load nvd3 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.min.css"/>


    <h1>Počet kontaktů - in nvd3 barchart</h1>
    <script type="text/javascript" src="{% sstatic 'd3/d3_kontakty_barchart.js' %}"></script>
    <div id="my_chart">
      <svg></svg>
    </div>


    <div id="piechart" class="ct-chart">
        <h1 >Počet kontaktů - in nvd3 piechart</h1>
        <script type="text/javascript" src="{% sstatic 'd3/d3_kontakty_piechart.js' %}"></script>
        <div style="height:700px;" id="my_piechart">
          <svg></svg>
        </div>
    </div>

    <div id="encounter_distribution"> 
        <h1 > Četnost klientů podle počtu kontaktů</h1>
        <script type="text/javascript" src="{% sstatic 'd3/d3_encounterdistribution.js' %}"></script>
        <div style="height:400px;" id="encounter_distribution">
          <svg></svg>
        </div>
    </div>

    <div> {{ anamnesis }} </div>
    <div id="anamnesis"> 
        <h1> Anamnézy </h1>
        <script type="text/javascript" src="{% sstatic 'd3/d3_anamnesis.js' %}"></script>
        <div style="height:400px;" id="encounter_distribution">
          <svg></svg>
        </div>
    </div>

 

{% endblock %}