{% load i18n %}

{% if not add %}

<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.tmpl.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.autocsrf.js"></script>
<script type="text/javascript">
function add_new_note() {
    
    (function ($) {
        $.ajax({
            type : 'POST',
            url : '{% url admin:clients_add_note original.pk %}',
            dataType: 'json',
            data : {'text': $('#new_note').val()},
            success : function (data) {
                $('#note_template').tmpl(data).prependTo('#notes');
                $('#new_note').val('');
            },
            error : function () {
                alert('{% trans "Došlo k chybě při přidávání poznámky." %}');
            }
        });
    })(django.jQuery);
}
</script>
    
<script id="note_template" type="text/x-jquery-tmpl">
<div class="tr">
    <div class="td">${author}</div>
    <div class="td">${datetime}</div>
    <div class="td wrap_lines">${text}</div>
</div>
</script>
    
<div class="group tabular">
    <h2>{% trans "Poznámky ke klientovi" %}</h2>
    <div class="table module dynamic-form">
        <div class="module thead dynamic-form">
            <div class="tr">
                <div class="th">{% trans "Autor" %}</div>
                <div class="th">{% trans "Datum" %}</div>
                <div class="th">{% trans "Text" %}</div>
            </div>
        </div>
        <div class="module tbody dynamic-form" id="notes">
            {% for note in original.notes.all %}
            <div class="tr">
                <div class="td">{{ note.author }}</div>
                <div class="td">{{ note.datetime|date:"DATETIME_FORMAT" }}</div>
                <div class="td wrap_lines">{{ note.text }}</div>
            </div>
            {% endfor %}
            <div class="tr">
                <div class="td">&nbsp;</div>
                <div class="td">&nbsp;</div>
                <div class="td"><textarea id="new_note" style="width: 50%; margin-right: 20px;"></textarea><input type="button" onclick="add_new_note();" value="{% trans "Přidat poznámku" %}" /></div>
            </div>
        </div>
    </div>
</div>

{% endif %}
